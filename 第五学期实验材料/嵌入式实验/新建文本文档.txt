#include <stdio.h> 
#include <LPC2103.H>	 //引用头文件
#define uint8 char
#define uint32 char


#define   LS164_DATA     (1<<2)    //LS164_DATA=0x0200 0000
#define   LS164_CLK      (1<<0)      //LS164_CLK=0x2000 0000
#define   LS164_CLR       (1<<1)       //LS164_CLR=0x0002 0000
/**************************************************************************
**  名称: void LS164_Init(void)
**  功能:  初始化子程序。
**  入口参数:  无
**  出口参数:  无
**************************************************************************/
void LS164_Init(void)
{
	PINSEL0 = 0X00000000; //
	//-------------  设置各引脚输出方向都为输出-------------
	IODIR = IODIR | LS164_DATA;    //  设置 P0.2 为输出
	IODIR = IODIR | LS164_CLK;     //  设置 P0.0 为输出
	IODIR = IODIR | LS164_CLR;      //  设置 P0.1 为输出
}
void   LS164_SendData (char data)
	{  int  j;      //定义一个 8 位无符号整型变量 j
	IOCLR = LS164_CLR;             //74LS164 输出清零
	IOSET = LS164_CLR;        
	//----------------模拟时钟信号，循环 8 次完成数据传送---------------
	for(j=0; j<8; j++)
	{
	IOCLR = LS164_CLK;    //向 74LS164 发送一个低电平时钟信号
	if ( (data & 0x01) != 0 )      //低位先传送。判断最低位是否为 1
	IOSET = LS164_DATA;   
	else 
	IOCLR = LS164_DATA;
	data >>=1;              //data 右移一位
	IOSET = LS164_CLK;      //向 74LS164 发送一个高电平时钟信号
	}
	IOCLR = LS164_CLK;
}
uint8 const LS164_TAB[32]={0x00,0x01,0x03,0x07,0x0F,0x1F,0x3F,0x7F,
0xFF,0x7F,0x3F, 0x1F,0x0F,0x07,0x03,0x01,0x00,0x81,0x42,0x24,
0x18,0x3c,0x7e,0xff,0x00,0xff,0x00,0x55, 0xaa,0x55, 0xaa,0x00};
/**************************************************************************** 
**    函数名称：DelayMS 
**   功能描述：延时函数 
**   入口参数：uiDly      值越大，延时时间越长 
**    出口参数：无 
****************************************************************************/ 
void DelayNS (int uiDly) 
{ 
	int i; 
	for (; uiDly > 0; uiDly--){ 
	for(i = 0; i < 25000; i++); 
} 	  
}
/**************************************************************************
*  名称：main（）
*  功能：软件模拟 UART 通信，通过 64LS164 控制 LED 灯，实现流水灯效果
*************************************************************************/
int main (void)
{ 
	int    i;
	LS164_Init();                         //  引脚初始化
	while(1)
	{      //------------------发送数据-------------------
		for(i=1;i<32;i++)
		{    LS164_SendData(LS164_TAB[i]);  //  发送数据
				DelayNS(30);                     //大约延时 100 毫秒
		}
	}
	return 0;
}
/***************************************************************************
**                             End    Of    File
***************************************************************************/